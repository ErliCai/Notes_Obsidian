
## Web 及网络基础


### 页面是如何呈现的

Web 页面当然不能凭空显示出来。根据 Web 浏览器地址栏中指定的 URL，Web 浏览器从 Web 服务器端获取文件资源（resource）等信 息，从而显示出 Web 页面。

Web 使用一种名为 HTTP 的协议作为规范，完成从客户端到服务器端等一系列运作流程

### HTTP 的诞生

#### 1989 年 3 月

1989 年 3 月  HTTP 诞生了 CERN（欧洲核子研究组织）的蒂姆 • 伯纳斯 - 李（Tim BernersLee）

最初设想的基本理念是：借助多文档之间相互关联形成的超文本 （HyperText），连成可相互参阅的 WWW（World Wide Web，万维 网）

3 项 WWW 构建技术:
- 把 SGML（Standard Generalized Markup Language，标准通用标记语言）作为页面的文本标 记语言的 HTML（HyperText Markup Language，超文本标记语言）； 
- 作为文档传递协议的 HTTP;
- 指定文档所在地址的 URL（UniformResource Locator，统一资源定位符）

#### 1990 年 11 月

CERN 成功研发了世界上第一台 Web 服务器和 Web 浏 览器

1990 年，大家针对 HTML1.0 草案进行了讨论，因 HTML1.0 中存在 多处模糊不清的部分，草案被直接废弃了

#### 1993 年 1 月

现代浏览器的祖先 NCSA（National Center for Supercomputer Applications，美国国家超级计算机应用中心）研发的 Mosaic 问世了

它以 in-line（内联）等形式显示 HTML的图像，在 图像方面出色的表现使它迅速在世界范围内流行开来

#### 1994 年 的 12 月

网景通信公司发布了 Netscape Navigator 1.0

#### 1995 年

微软公司发布 Internet Explorer 1.0 和 2.0

紧随其后的是现在已然成为 Web 服务器标准之一的 Apache，当时它 以 Apache 0.2 的姿态出现在世人眼前。而 HTML也发布了 2.0 版本

从 1995 年左右起，微软公司与网景通信公司之间爆发的 浏览器大战愈演愈烈。两家公司都各自对 HTML做了扩展，于是导 致在写 HTML页面时，必须考虑兼容他们两家公司的浏览器。

#### 2000 年前后

浏览器战争随着网景通信公司的衰落而暂告一段 落。但就在 2004 年，Mozilla 基金会发布了 Firefox 浏览器，第二次 浏览器大战随即爆发。

### HTTP 版本

#### HTTP/0.9 
HTTP 于 1990 年问世。那时的 HTTP 并没有作为正式的标准被建立。 现在的 HTTP 其实含有 HTTP1.0 之前版本的意思，因此被称为 HTTP/0.9。

#### HTTP/1.0 
HTTP 正式作为标准被公布是在 1996 年的 5 月，版本被命名为 HTTP/1.0，并记载于 RFC1945。虽说是初期标准，但该协议标准至今 仍被广泛使用在服务器端。

#### HTTP/1.1
1997 年 1 月公布的 HTTP/1.1 是目前主流的 HTTP 协议版本。当初的 标准是 RFC2068，之后发布的修订版 RFC2616 就是当前的最新版 本。

#### HTTP/2.0
新 一代 HTTP/2.0 正在制订中，但要达到较高的使用覆盖率，仍需假以 时日



### TCP/IP

网络（包括互联网）是在 TCP/IP 协议族的基础上运作 的。而 HTTP 属于它内部的一个子集。

#### TCP/IP 协议族

计算机与网络设备要相互通信，双方就必须基于相同的方法。比如， 如何探测到通信目标、由哪一边先发起通信、使用哪种语言进行通 信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之 间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为 __协议__

像这样把与互联网相关联的协议集合起来总称为 __TCP/IP__

#### TCP/IP 的分层管理

TCP/IP 协议族按层次分别分 为以下 4 层：应用层、传输层、网络层和数据链路层

把 TCP/IP 层次化是有好处的。比如，如果互联网只由一个协议统 筹，某个地方需要改变设计时，就必须把所有部分整体替换掉。而分 层之后只需把变动的层替换掉即可。把各层之间的接口部分规划好之 后，每个层次内部的设计就能够自由改动了。

- 应用层: 应用层决定了向用户提供应用服务时通信的活动。FTP,DNS,HTTP
- 传输层: 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输 TCP, UDP
- 网络层: 网络层用来处理在网络上流动的数据包
- 链路层: 用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等

#### TCP/IP 通信传输流

![[TCPIP_Workflow.png]]![[data_in_tcpip.png]]

### 与 HTTP 关系密切的协议

#### IP (Internet Protocol)

IP 协议的作用是把各种数据包传送给对方

要保证确实传送到对方 那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址

IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定 地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改

在到达通信目标前的中转过程中，计算机和路由器等网络设备只 能获悉很粗略的传输路线

#### TCP (Transmission Control Protocol)

TCP 位于传输层，提供可靠的字节流服务

TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够 确认数据最终是否送达到对方

#### DNS (Domain Name System)

它提供域名到 IP 地址之间的解析服务

计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。比如 www.googlge.com

用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP 地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表 示形式来指定计算机名更符合人类的记忆习惯

![[DNS.png]]

### URI / URL

与 URI（统一资源标识符）相比，我们更熟悉 URL（Uniform Resource Locator，统一资源定位符）

#### URL (Uniform Resource Locator)

URL正是使用 Web 浏览器等 访问 Web 页面时需要输入的网页地址
#### URI (Uniform Resource Identifier)

URI 就是由某个协议方案表示的资源的定位标识符

协议方案是指访问资源所使用的协议类型名称, 采用 HTTP 协议时，协议方案就是 http
####

URI 用字符串标识某一互联网资源
而 URL表示资源的地点（互联网上所处的位置）
可见 URL是 URI 的子集
#### URI 的格式

![[request_uri.png]]

- 登录信息: 指定用户名和密码作为从服务器端获取资源时必要的登录信息（身份认证）。此项是可选项
- 服务器地址:使用绝对 URI 必须指定待访问的服务器地址。地址可以是类似 hackr.jp 这种 DNS 可解析的名称，或是 192.168.1.1 这类 IPv4 地址
- 服务器端口号:指定服务器连接的网络端口号。此项也是可选项，若用户省略则自动 使用默认端口号
- 带层次的文件路径:指定服务器上的文件路径来定位特指的资源
- 查询字符串: 针对已指定的文件路径内的资源，可以使用查询字符串传入任意参 数。
- 片段标识符: 使用片段标识符通常可标记出已获取资源中的子资源

## 简单的 HTTP 协议

HTTP 协议和 TCP/IP 协议族内的其他众多的协议相同，用于客户端和 服务器之间的通信

请求访问文本或图像等资源的一端称为**客户端**，而提供资源响应的一 端称为**服务器端**。

HTTP 协议规定，请求从客户端发出，最后服务器端响应该请求并返 回


HTTP 是一种**不保存状态，即无状态（stateless）协议**。HTTP 协议自 身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个 级别，协议对于发送过的请求或响应都不做持久化处理

这是为了 **更快地处理大量事务，确保协议的可伸缩性**，而特意把 HTTP 协议设 计成如此简单的

HTTP/1.1 虽然是无状态协议，但为了实现期望的保持状态功能，于 是引入了 Cookie 技术。有了 Cookie 再用 HTTP 协议通信，就可以管 理状态了

告知服务器意图的 HTTP 方法
- GET ：获取资源
     GET 方法用来请求访问已被 URI 识别的资源。指定的资源经服务器 端解析后返回响应内容
- POST：传输实体主体
- PUT：传输文件
- HEAD：获得报文首部
     HEAD 方法和 GET 方法一样，只是不返回报文主体部分
- DELETE：删除文件
- OPTIONS：询问支持的方法
- TRACE：追踪路径
- CONNECT：要求用隧道协议连接代理

#### 持久连接节省通信量

![[connection.png]]
- 持久连接 HTTP keep-alive

持久连接的特点是，只要任意一端 没有明确提出断开连接，则保持 TCP 连接状态
![[http_keep_alive.png]]
- 管线化
![[pipeline.png]]

### 使用 Cookie 的状态管理

![[no_cookie.png]]

![[cookie.png]]![[cokkie2.png]]

## HTTP 报文

![[http.png]]![[报文.png]]

### 报文主体和实体主体的差异

- 报文（message）
     是 HTTP 通信中的基本单位，由 8 位组字节流（octet sequence， 其中 octet 为 8 个比特）组成，通过 HTTP 通信传输。
- 实体（entity）
     作为请求或响应的有效载荷数据（补充项）被传输，其内容由实 体首部和实体主体组成。

通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体 主体的内容发生变化，才导致它和报文主体产生差异

### 压缩传输的内容编码

向待发送邮件内增加附件时，为了使邮件容量变小，我们会先用 ZIP 压缩文件之后再添加附件发送

- gzip（GNU zip） 
- compress（UNIX 系统的标准压缩） 
- deflate（zlib） 
- identity（不进行编码）

### 获取部分内容的范围请求

如果下载过程中遇到网络 中断的情况，那就必须重头开始。为了解决上述问题，需要一种可恢 复的机制。所谓恢复是指能从之前下载中断处恢复下载

要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请 求叫做范围请求（Range Request）

![[byteRange.png]]
### 内容协商返回最合适的内容

当浏览器的默认语言为英语或中文，访问相同 URI 的 Web 页面时， 则会显示对应的英语版或中文版的 Web 页面。这样的机制称为内容 协商（Content Negotiation）。

- 服务器驱动协商（Server-driven Negotiation）
- 客户端驱动协商（Agent-driven Negotiation）
- 透明协商（Transparent Negotiation）

## HTTP 状态码

![[httpStatusCode.png]]

## Web 服 务器

### 用单台虚拟主机实现多个域名

HTTP/1.1 规范允许一台 HTTP 服务器搭建多个 Web 站点。比如，提 供 Web 托管服务（Web Hosting Service）的供应商，可以用一台服务 器为多位客户服务，也可以以每位客户持有的域名运行各自不同的网 站。

在相同的 IP 地址下，由于虚拟主机可以寄存多个不同主机名和域名 的 Web 网站，因此在发送 HTTP 请求时，**必须在 Host 首部内完整指 定主机名或域名的 URI**

### 通信数据转发程序

#### 代理

代理是一种有转发功能的应用程序，它扮演了位于服务器和客户 端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时 也接收服务器返回的响应并转发给客户端

使用代理服务器的理由有：利用缓存技术减少网络带宽 的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要 目的

#### 网关

利用网关可以由 HTTP 请求转化为其他协议通信

网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提 供非 HTTP 协议服务。

利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信 线路上加密以确保连接的安全。比如，网关可以连接数据库，使用 SQL语句查询数据。

#### 隧道

隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信

### 缓存

缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存 可减少对源服务器的访问，因此也就节省了通信流量和通信时间

#### 缓存的有效期限

当遇上源服务器上的资源更新时，如果还是使用不变的缓存，那就会演变成返回更新前的“旧”资源了

#### 客户端的缓存

缓存不仅可以存在于缓存服务器内，还可以存在客户端浏览器中。以 Internet Explorer 程序为例，把客户端缓存称为临时网络文件 (Temporary Internet File)。

浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘内读取

## HTTP 首部

![[request_header.png]]

![[request_header_example.png]]

### HTTP 首部字段

#### HTTP 首部字段传递重要信息

HTTP 首部字段是构成 HTTP 报文的要素之一。在客户端与服务器之 间以 HTTP 协议进行通信的过程中，无论是请求还是响应都会使用首 部字段，它能起到传递额外重要信息的作用。

使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等内容。

#### HTTP 首部字段结构

HTTP 首部字段是由首部字段名和字段值构成的，中间用冒号“:” 分 隔。
```
Content-Type: text/html
```

另外，字段值对应单个 HTTP 首部字段可以有多个值
```
Keep-Alive: timeout=15, max=100
```

#### 4 种 HTTP 首部字段类型

- 通用首部字段(General Header Fields)
![[general_header_field.png]]
- 请求首部字段(Request Header Fields)
![[request_header_field.png]]
- 响应首部字段(Response Header Fields)
![[response_header_field.png]]
- 实体首部字段(Entity Header Fields)
![[entity_header_field.png]]

#### End-to-end 首部和 Hop-by-hop 首部

- 端到端首部(End-to-end Header)

分在此类别中的首部会转发给请求 / 响应对应的最终接收目标，且必 须保存在由缓存生成的响应中，另外规定它必须被转发。

- 逐跳首部(Hop-by-hop Header)

分在此类别中的首部只对单次转发有效，会因通过缓存或代理而不再 转发。HTTP/1.1 和之后版本中，如果要使用 hop-by-hop 首部，需提 供 Connection 首部字段。

### 非 HTTP/1.1 首部字段

在 HTTP 协议通信交互中使用到的首部字段，不限于 RFC2616 中定义的 47 种首部字段。还有 Cookie、Set-Cookie 和 Content-Disposition 等在其他 RFC 中定义的首部字段，它们的使用频率也很高。

![[cookie_header.png]]


## 确保Web安全的 HTTPS

### HTTP 的缺点

- 通信使用明文(不加密)，内容可能会被窃听 
     TCP/IP 是可能被窃听的网络
     HTTP 协议中没有加密机制，但可以通过和 SSL(Secure Socket Layer，安全套接层)或 TLS (Transport Layer Security，安全层传输协议)的组合使用， 加密 HTTP 的通信内容
     用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信了。与 SSL 组合使用的 HTTP 被称为 HTTPS(HTTP Secure，超文本传输安全协议)或 HTTP over SSL
- 不验证通信方的身份，因此有可能遭遇伪装 
     在 HTTP 协议通信时，由于不存在确认通信方的处理步骤，任何 人都可以发起请求。另外，服务器只要接收到请求，不管对方是 谁都会返回一个响应
     
     无法确定请求发送至目标的 Web 服务器是否是按真实意 图返回响应的那台服务器。有可能是已伪装的 Web 服务 器
     无法确定响应返回到的客户端是否是按真实意图接收响 应的那个客户端。有可能是已伪装的客户端
     无法确定正在通信的对方是否具备访问权限。因为某些 Web 服务器上保存着重要的信息，只想发给特定用户通 信的权限
     即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击
     
     虽然使用 HTTP 协议无法确定通信方，但如果使用 SSL 则可以。 SSL 不仅提供加密处理，而且还使用了一种被称为证书的手段， 可用于确定方
     证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方(服务器或客户端)持有的证书，即可判断通信方的真实意图
- 无法证明报文的完整性，所以有可能已遭篡改
     由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响 应送出之后直到对方接收之前的这段时间内，即使请求或响应的 内容遭到篡改，也没有办法获悉
     虽然有使用 HTTP 协议确定报文完整性的方法，但事实上并不便捷、可靠。其中常用的是 MD5 和 SHA-1 等散列值校验的方法， 以及用来确认文件的数字签名方法

### HTTP+ 加密 + 认证 + 完整性保护 =HTTPS

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL(Secure Socket Layer)和 TLS(Transport Layer Security)协议代替而已

通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通 信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP

![[networking/image/HTTPS.png]]

### 相互交换密钥的公开密钥加密技术

- 共享密钥加密的困境
     以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交?在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时也就失去了加密的意义

- 使用两把密钥的公开密钥加密
     RSA
- HTTPS 采用混合加密机制
![[HTTP_encryption.png]]

### 证明公开密钥正确性的证书

遗憾的是，公开密钥加密方式还是存在一些问题的。那就是无法证明公开密钥本身就是货真价实的公开密钥

比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉

为了解决上述问题，可以使用由数字证书认证机构(CA，Certificate Authority)和其相关机关颁发的公开密钥证书. 数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上

首先，服务器 的运营人员向数字证书认证机构提出公开密钥的申请。数字证书认证 机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签 名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书 后绑定在一起. 服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信。公钥证书也可叫做数字证书或直接称为证书。

- 可证明组织真实性的 EV SSL 证书
     证书的一个作用是用来证明作为通信一方的服务器是否规范，另 外一个作用是可确认对方服务器背后运营的企业是否真实存在
- 用以确认客户端的客户端证书
- 认证机构信誉第一

### HTTPS 的安全通信机制

![[HTTPS 1.png]]

![[HTTPS2.png]]

### SSL 速度慢吗

HTTPS 也存在一些问题，那就是当使用 SSL 时，它的处理速度会变慢

SSL 的慢分两种。一种是指通信慢。另一种是指由于大量消耗CPU 及内存等资源，导致处理速度变慢。

和使用 HTTP 相比，网络负载可能会变慢 2 到 100 倍。除去和 TCP 连接、发送 HTTP 请求 • 响应以外，还必须进行 SSL 通信， 因此整体上处理通信量不可避免会增加

另一点是 SSL 必须进行加密处理。在服务器和客户端都需要进行 加密和解密的运算处理。因此从结果上讲，比起 HTTP 会更多地 消耗服务器和客户端的硬件资源，导致负载增强

## 基于 HTTP 的功能追加协议

在建立 HTTP 标准规范时，制订者主要想把 HTTP 当作传输 HTML 文 档的协议。随着时代的发展，Web 的用途更具多样性，比如演化成在 线购物网站、SNS(Social Networking Service，社交网络服务)、企 业或组织内部的各种管理工具，等等

而这些网站所追求的功能可通过 Web 应用和脚本程序实现。即使这 些功能已经满足需求，在性能上却未必最优，这是因为 HTTP 协议上 的限制以及自身性能有限

有一些新协议的规则是基于 HTTP 的，并在此基础上添加了新的功能。

### HTTP 的瓶颈

- 一条连接上只可发送一个请求。
- 请求只能从客户端开始。客户端不可以接收除响应以外的指令。
- 请求 / 响应首部未经压缩就发送。首部信息越多延迟越大。
- 发送冗长的首部。每次互相发送相同的首部造成的浪费较多。
- 可任意选择数据压缩格式。非强制压缩发送
![[HTTP_bottleneck.png]]
### 解决方法

#### Ajax 的解决方法

Ajax(Asynchronous JavaScript and XML, 异 步 JavaScript 与 XML 技 术)是一种有效利用 JavaScript 和 DOM(Document Object Model，文 档对象模型)的操作，以达到局部 Web 页面替换加载的异步通信手段

和以前的同步通信相比，由于它只更新一部分页面，响应中传输 的数据量会因此而减少，这一优点显而易见. 而利用 Ajax 实时地从服务器获取内容，有可能会导致大量请求产 生。另外，Ajax 仍未解决 HTTP 协议本身存在的问题

![[ajax.png]]

#### Comet的解决方法

一旦服务器端有内容更新了，Comet 不会让请求等待，而是直接给客 户端返回响应。这是一种通过延迟应答，模拟实现服务器端向客户端推送(Server Push)的功能

内容上虽然可以做到实时更新，但为了保留响应，一次连接的持续时 间也变长了。期间，为了维持连接会消耗更多的资源。另外，Comet 也仍未解决 HTTP 协议本身存在的问题

![[Pasted image 20240108215704.png]]

### SPDY

SPDY 没有完全改写 HTTP 协议，而是在 TCP/IP 的应用层与运输层之 间通过新加会话层的形式运作

使用 SPDY 后，HTTP 协议额外获得以下功能。
- 多路复用流:通过单一的 TCP 连接，可以无限制处理多个 HTTP 请求。
- 赋予请求优先级: SPDY 不仅可以无限制地并发处理请求，还可以给请求逐个分配优先 级顺序
- 压缩HTTP首部
- 推送功能: 支持服务器主动向客户端推送数据的功能
- 服务器提示功能: 服务器可以主动提示客户端请求所需的资源

