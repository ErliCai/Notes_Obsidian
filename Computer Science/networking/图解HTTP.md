
## Web 及网络基础


### 页面是如何呈现的

Web 页面当然不能凭空显示出来。根据 Web 浏览器地址栏中指定的 URL，Web 浏览器从 Web 服务器端获取文件资源（resource）等信 息，从而显示出 Web 页面。

Web 使用一种名为 HTTP 的协议作为规范，完成从客户端到服务器端等一系列运作流程

### HTTP 的诞生

#### 1989 年 3 月

1989 年 3 月  HTTP 诞生了 CERN（欧洲核子研究组织）的蒂姆 • 伯纳斯 - 李（Tim BernersLee）

最初设想的基本理念是：借助多文档之间相互关联形成的超文本 （HyperText），连成可相互参阅的 WWW（World Wide Web，万维 网）

3 项 WWW 构建技术:
- 把 SGML（Standard Generalized Markup Language，标准通用标记语言）作为页面的文本标 记语言的 HTML（HyperText Markup Language，超文本标记语言）； 
- 作为文档传递协议的 HTTP;
- 指定文档所在地址的 URL（UniformResource Locator，统一资源定位符）

#### 1990 年 11 月

CERN 成功研发了世界上第一台 Web 服务器和 Web 浏 览器

1990 年，大家针对 HTML1.0 草案进行了讨论，因 HTML1.0 中存在 多处模糊不清的部分，草案被直接废弃了

#### 1993 年 1 月

现代浏览器的祖先 NCSA（National Center for Supercomputer Applications，美国国家超级计算机应用中心）研发的 Mosaic 问世了

它以 in-line（内联）等形式显示 HTML的图像，在 图像方面出色的表现使它迅速在世界范围内流行开来

#### 1994 年 的 12 月

网景通信公司发布了 Netscape Navigator 1.0

#### 1995 年

微软公司发布 Internet Explorer 1.0 和 2.0

紧随其后的是现在已然成为 Web 服务器标准之一的 Apache，当时它 以 Apache 0.2 的姿态出现在世人眼前。而 HTML也发布了 2.0 版本

从 1995 年左右起，微软公司与网景通信公司之间爆发的 浏览器大战愈演愈烈。两家公司都各自对 HTML做了扩展，于是导 致在写 HTML页面时，必须考虑兼容他们两家公司的浏览器。

#### 2000 年前后

浏览器战争随着网景通信公司的衰落而暂告一段 落。但就在 2004 年，Mozilla 基金会发布了 Firefox 浏览器，第二次 浏览器大战随即爆发。

### HTTP 版本

#### HTTP/0.9 
HTTP 于 1990 年问世。那时的 HTTP 并没有作为正式的标准被建立。 现在的 HTTP 其实含有 HTTP1.0 之前版本的意思，因此被称为 HTTP/0.9。

#### HTTP/1.0 
HTTP 正式作为标准被公布是在 1996 年的 5 月，版本被命名为 HTTP/1.0，并记载于 RFC1945。虽说是初期标准，但该协议标准至今 仍被广泛使用在服务器端。

#### HTTP/1.1
1997 年 1 月公布的 HTTP/1.1 是目前主流的 HTTP 协议版本。当初的 标准是 RFC2068，之后发布的修订版 RFC2616 就是当前的最新版 本。

#### HTTP/2.0
新 一代 HTTP/2.0 正在制订中，但要达到较高的使用覆盖率，仍需假以 时日



### TCP/IP

网络（包括互联网）是在 TCP/IP 协议族的基础上运作 的。而 HTTP 属于它内部的一个子集。

#### TCP/IP 协议族

计算机与网络设备要相互通信，双方就必须基于相同的方法。比如， 如何探测到通信目标、由哪一边先发起通信、使用哪种语言进行通 信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之 间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为 __协议__

像这样把与互联网相关联的协议集合起来总称为 __TCP/IP__

#### TCP/IP 的分层管理

TCP/IP 协议族按层次分别分 为以下 4 层：应用层、传输层、网络层和数据链路层

把 TCP/IP 层次化是有好处的。比如，如果互联网只由一个协议统 筹，某个地方需要改变设计时，就必须把所有部分整体替换掉。而分 层之后只需把变动的层替换掉即可。把各层之间的接口部分规划好之 后，每个层次内部的设计就能够自由改动了。

- 应用层: 应用层决定了向用户提供应用服务时通信的活动。FTP,DNS,HTTP
- 传输层: 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输 TCP, UDP
- 网络层: 网络层用来处理在网络上流动的数据包
- 链路层: 用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等

#### TCP/IP 通信传输流

![[TCPIP_Workflow.png]]![[data_in_tcpip.png]]

### 与 HTTP 关系密切的协议

#### IP (Internet Protocol)

IP 协议的作用是把各种数据包传送给对方

要保证确实传送到对方 那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址

IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定 地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改

在到达通信目标前的中转过程中，计算机和路由器等网络设备只 能获悉很粗略的传输路线

#### TCP (Transmission Control Protocol)

TCP 位于传输层，提供可靠的字节流服务

TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够 确认数据最终是否送达到对方

#### DNS (Domain Name System)

它提供域名到 IP 地址之间的解析服务

计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。比如 www.googlge.com

用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP 地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表 示形式来指定计算机名更符合人类的记忆习惯

![[DNS.png]]

### URI / URL

与 URI（统一资源标识符）相比，我们更熟悉 URL（Uniform Resource Locator，统一资源定位符）

#### URL (Uniform Resource Locator)

URL正是使用 Web 浏览器等 访问 Web 页面时需要输入的网页地址
#### URI (Uniform Resource Identifier)

URI 就是由某个协议方案表示的资源的定位标识符

协议方案是指访问资源所使用的协议类型名称, 采用 HTTP 协议时，协议方案就是 http
####

URI 用字符串标识某一互联网资源
而 URL表示资源的地点（互联网上所处的位置）
可见 URL是 URI 的子集
#### URI 的格式

![[request_uri.png]]

- 登录信息: 指定用户名和密码作为从服务器端获取资源时必要的登录信息（身份认证）。此项是可选项
- 服务器地址:使用绝对 URI 必须指定待访问的服务器地址。地址可以是类似 hackr.jp 这种 DNS 可解析的名称，或是 192.168.1.1 这类 IPv4 地址
- 服务器端口号:指定服务器连接的网络端口号。此项也是可选项，若用户省略则自动 使用默认端口号
- 带层次的文件路径:指定服务器上的文件路径来定位特指的资源
- 查询字符串: 针对已指定的文件路径内的资源，可以使用查询字符串传入任意参 数。
- 片段标识符: 使用片段标识符通常可标记出已获取资源中的子资源

## 简单的 HTTP 协议

HTTP 协议和 TCP/IP 协议族内的其他众多的协议相同，用于客户端和 服务器之间的通信

请求访问文本或图像等资源的一端称为**客户端**，而提供资源响应的一 端称为**服务器端**。

HTTP 协议规定，请求从客户端发出，最后服务器端响应该请求并返 回


HTTP 是一种**不保存状态，即无状态（stateless）协议**。HTTP 协议自 身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个 级别，协议对于发送过的请求或响应都不做持久化处理

这是为了 **更快地处理大量事务，确保协议的可伸缩性**，而特意把 HTTP 协议设 计成如此简单的

HTTP/1.1 虽然是无状态协议，但为了实现期望的保持状态功能，于 是引入了 Cookie 技术。有了 Cookie 再用 HTTP 协议通信，就可以管 理状态了

告知服务器意图的 HTTP 方法
- GET ：获取资源
     GET 方法用来请求访问已被 URI 识别的资源。指定的资源经服务器 端解析后返回响应内容
- POST：传输实体主体
- PUT：传输文件
- HEAD：获得报文首部
     HEAD 方法和 GET 方法一样，只是不返回报文主体部分
- DELETE：删除文件
- OPTIONS：询问支持的方法
- TRACE：追踪路径
- CONNECT：要求用隧道协议连接代理

#### 持久连接节省通信量

![[connection.png]]
- 持久连接 HTTP keep-alive

持久连接的特点是，只要任意一端 没有明确提出断开连接，则保持 TCP 连接状态
![[http_keep_alive.png]]
- 管线化
![[pipeline.png]]

### 使用 Cookie 的状态管理

![[no_cookie.png]]

![[cookie.png]]![[cokkie2.png]]

## HTTP 报文

![[http.png]]![[报文.png]]

### 报文主体和实体主体的差异

- 报文（message）
     是 HTTP 通信中的基本单位，由 8 位组字节流（octet sequence， 其中 octet 为 8 个比特）组成，通过 HTTP 通信传输。
- 实体（entity）
     作为请求或响应的有效载荷数据（补充项）被传输，其内容由实 体首部和实体主体组成。

通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体 主体的内容发生变化，才导致它和报文主体产生差异

### 压缩传输的内容编码

向待发送邮件内增加附件时，为了使邮件容量变小，我们会先用 ZIP 压缩文件之后再添加附件发送

- gzip（GNU zip） 
- compress（UNIX 系统的标准压缩） 
- deflate（zlib） 
- identity（不进行编码）

### 获取部分内容的范围请求

如果下载过程中遇到网络 中断的情况，那就必须重头开始。为了解决上述问题，需要一种可恢 复的机制。所谓恢复是指能从之前下载中断处恢复下载

要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请 求叫做范围请求（Range Request）

![[byteRange.png]]
### 内容协商返回最合适的内容

当浏览器的默认语言为英语或中文，访问相同 URI 的 Web 页面时， 则会显示对应的英语版或中文版的 Web 页面。这样的机制称为内容 协商（Content Negotiation）。

- 服务器驱动协商（Server-driven Negotiation）
- 客户端驱动协商（Agent-driven Negotiation）
- 透明协商（Transparent Negotiation）

## HTTP 状态码

![[httpStatusCode.png]]

## Web 服 务器

### 用单台虚拟主机实现多个域名

HTTP/1.1 规范允许一台 HTTP 服务器搭建多个 Web 站点。比如，提 供 Web 托管服务（Web Hosting Service）的供应商，可以用一台服务 器为多位客户服务，也可以以每位客户持有的域名运行各自不同的网 站。

在相同的 IP 地址下，由于虚拟主机可以寄存多个不同主机名和域名 的 Web 网站，因此在发送 HTTP 请求时，**必须在 Host 首部内完整指 定主机名或域名的 URI**

### 通信数据转发程序

#### 代理

代理是一种有转发功能的应用程序，它扮演了位于服务器和客户 端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时 也接收服务器返回的响应并转发给客户端

使用代理服务器的理由有：利用缓存技术减少网络带宽 的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要 目的

#### 网关

利用网关可以由 HTTP 请求转化为其他协议通信

网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提 供非 HTTP 协议服务。

利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信 线路上加密以确保连接的安全。比如，网关可以连接数据库，使用 SQL语句查询数据。

#### 隧道

隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信

### 缓存

缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存 可减少对源服务器的访问，因此也就节省了通信流量和通信时间

